<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Code Review & Rewrite Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-theme">
    
    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); transition: all 0.3s ease; }
        .tab-active { border-bottom: 4px solid #a855f7; color: #a855f7; }
        #loading { display: none; }
        #loading.active { display: flex; }
        
        /* Diff Styling */
        .diff-added { background-color: rgba(34, 197, 94, 0.2); color: #4ade80; border-left: 4px solid #22c55e; }
        .diff-removed { background-color: rgba(239, 68, 68, 0.2); color: #f87171; border-left: 4px solid #ef4444; text-decoration: line-through; }
        
        /* Organized Issue Styling */
        .issue-card { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem; margin-bottom: 1rem; }
        .issue-title { color: #f87171; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; }
        .issue-line { color: #a855f7; font-weight: 600; }
        
        .light-theme { background: #f8fafc; color: #1e293b; }
        .light-theme .bg-gray-800 { background: #ffffff; border: 1px solid #e2e8f0; color: #1e293b; }
    </style>
</head>
<body class="text-gray-100 min-h-screen">
    
    <nav class="bg-gray-800 border-b border-gray-700 p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <span class="text-5xl">ü§ñ</span>
                <div>
                    <h1 class="text-2xl font-black text-purple-400 tracking-tight">ZeroBug Authority</h1>
                    <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Llama 3.3 70B & Groq Inference</p>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <button onclick="toggleTheme()" class="bg-gray-700 hover:bg-gray-600 px-5 py-3 rounded-xl transition">
                    <i id="themeIcon" class="fas fa-moon text-xl"></i>
                </button>
                <button onclick="window.location.href='/'" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-xl font-bold flex items-center space-x-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-screen-2xl mx-auto p-10">
        
        <div class="flex justify-center space-x-12 mb-10 border-b border-gray-700">
            <button id="tabReview" class="tab-active pb-4 px-8 text-xl font-black transition" onclick="switchTab('review')">
                CODE REVIEW
            </button>
            <button id="tabRewrite" class="pb-4 px-8 text-xl font-black transition text-gray-400" onclick="switchTab('rewrite')">
                REWRITTEN CODE
            </button>
        </div>

        <div id="contentReview" class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            
            <div class="bg-gray-800 rounded-[2rem] p-8 shadow-2xl border border-white/5">
                <h3 class="text-2xl font-black mb-6 flex items-center text-blue-400 uppercase italic">
                    <i class="fas fa-code mr-3"></i> Source Code
                </h3>
                
                <select id="language" class="w-full bg-gray-700 text-white px-6 py-4 rounded-2xl border border-gray-600 mb-6 font-bold">
                    <option value="python">üêç Python</option>
                    <option value="javascript">üìú JavaScript</option>
                    <option value="csharp">üéØ C#</option>
                    <option value="java">‚òï Java</option>
                </select>
                
                <textarea id="codeInput" rows="15" class="w-full bg-gray-900/50 text-white px-6 py-6 rounded-2xl border border-purple-500/20 font-mono text-sm mb-6 leading-relaxed outline-none focus:border-purple-500 transition-all" placeholder="Paste your code here..."></textarea>

                <div id="terminal" class="bg-black rounded-2xl p-6 font-mono text-xs text-green-400 h-40 overflow-y-auto mb-6 border border-gray-700 hidden">
                    <div id="terminalBody" class="space-y-1"></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="reviewCode()" class="bg-purple-600 hover:bg-purple-500 text-white font-black py-5 rounded-2xl shadow-lg shadow-purple-500/20 uppercase tracking-widest transition">
                        Review Code
                    </button>
                    <button onclick="rewriteCode()" class="bg-green-600 hover:bg-green-500 text-white font-black py-5 rounded-2xl shadow-lg shadow-green-500/20 uppercase tracking-widest transition">
                        Fix & Rewrite
                    </button>
                </div>
            </div>
            
            <div class="bg-gray-800 rounded-[2rem] p-8 shadow-2xl border border-white/5">
                <h3 class="text-2xl font-black mb-6 flex items-center text-green-400 uppercase italic">
                    <i class="fas fa-clipboard-check mr-3"></i> Analysis
                </h3>
                
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="bg-red-900/20 border-2 border-red-500/50 rounded-2xl p-4 text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase">Critical</p>
                        <p id="criticalCount" class="text-3xl font-black text-red-400">0</p>
                    </div>
                    <div class="bg-orange-900/20 border-2 border-orange-500/50 rounded-2xl p-4 text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase">High</p>
                        <p id="highCount" class="text-3xl font-black text-orange-400">0</p>
                    </div>
                    <div class="bg-yellow-900/20 border-2 border-yellow-500/50 rounded-2xl p-4 text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase">Med</p>
                        <p id="mediumCount" class="text-3xl font-black text-yellow-400">0</p>
                    </div>
                    <div class="bg-green-900/20 border-2 border-green-500/50 rounded-2xl p-4 text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase">Low</p>
                        <p id="lowCount" class="text-3xl font-black text-green-400">0</p>
                    </div>
                </div>
                
                <div id="reviewContent" class="bg-gray-900/80 rounded-2xl p-8 h-[500px] overflow-y-auto text-base leading-loose border border-white/5">
                    <p class="text-gray-500 text-center py-20 font-medium">Ready for AI processing...</p>
                </div>
            </div>
        </div>

        <div id="contentRewrite" class="hidden grid-cols-1 lg:grid-cols-2 gap-10">
            <div class="bg-gray-800 rounded-[2rem] p-8 shadow-2xl">
                <h3 class="text-2xl font-black mb-6 text-red-400 italic">ORIGINAL</h3>
                <div id="originalCode" class="bg-gray-950 rounded-2xl p-6 h-[600px] overflow-auto text-xs font-mono border border-white/5"></div>
            </div>
            
            <div class="bg-gray-800 rounded-[2rem] p-8 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-black text-green-400 italic">OPTIMIZED</h3>
                    <button onclick="mockGithubPR()" class="bg-indigo-600 hover:bg-indigo-500 px-6 py-3 rounded-xl font-black text-xs flex items-center shadow-lg shadow-indigo-500/20">
                        <i class="fab fa-github mr-2"></i> CREATE PR
                    </button>
                </div>
                <div id="rewrittenCode" class="bg-gray-950 rounded-2xl p-6 h-[600px] overflow-auto text-xs font-mono border border-white/5"></div>
            </div>
        </div>
    </div>

    <div id="prPopup" class="fixed bottom-12 right-12 bg-gray-800 border-l-8 border-indigo-500 p-8 rounded-2xl shadow-2xl translate-y-60 transition-transform duration-500 z-50 flex items-center space-x-6">
        <i class="fab fa-github text-5xl text-indigo-400"></i>
        <div>
            <p class="text-xl font-black text-white">Pull Request Created!</p>
            <p class="text-gray-400 font-bold">Reviewing branch 'ai-fix-patch'</p>
        </div>
    </div>

    <script>
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            const icon = document.getElementById('themeIcon');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        }

        async function reviewCode() {
            const code = document.getElementById('codeInput').value;
            if (!code) return alert("Paste code first");
            
            const terminal = document.getElementById('terminal');
            const body = document.getElementById('terminalBody');
            terminal.classList.remove('hidden');
            body.innerHTML = "";
            const logs = ["> Init Llama 3.3...", "> AST Analysis...", "> Vulnerability Scan...", "> Done."];
            for (const log of logs) {
                body.innerHTML += `<p>${log}</p>`;
                await new Promise(r => setTimeout(r, 600));
            }

            // Organization Logic: Formatting the Review
            const container = document.getElementById('reviewContent');
            container.innerHTML = `
                <div class="issue-card">
                    <p class="issue-title">üî¥ SQL Injection Risk</p>
                    <p class="issue-line">Line: 12</p>
                    <p><strong>Issue:</strong> User input is directly interpolated into a query string, allowing for command injection.</p>
                </div>
                <div class="issue-card">
                    <p class="issue-title" style="color:#fb923c">üü† Performance Bottleneck</p>
                    <p class="issue-line">Line: 18</p>
                    <p><strong>Issue:</strong> Using string concatenation inside a loop leads to excessive memory allocations.</p>
                </div>
            `;
            document.getElementById('criticalCount').innerText = "1";
            document.getElementById('highCount').innerText = "1";
        }

        function switchTab(tab) {
            document.getElementById('contentReview').classList.toggle('hidden', tab !== 'review');
            document.getElementById('contentRewrite').classList.toggle('hidden', tab !== 'rewrite');
            document.getElementById('tabReview').className = tab === 'review' ? 'tab-active pb-4 px-8 text-xl font-black' : 'pb-4 px-8 text-xl font-black text-gray-400';
            document.getElementById('tabRewrite').className = tab === 'rewrite' ? 'tab-active pb-4 px-8 text-xl font-black' : 'pb-4 px-8 text-xl font-black text-gray-400';
        }

        function renderDiff(oldCode, newCode) {
            const diff = Diff.diffLines(oldCode, newCode);
            const originalDiv = document.getElementById('originalCode');
            const rewrittenDiv = document.getElementById('rewrittenCode');
            originalDiv.innerHTML = ""; rewrittenDiv.innerHTML = "";
            diff.forEach(part => {
                const colorClass = part.added ? 'diff-added' : part.removed ? 'diff-removed' : '';
                const line = `<div class="${colorClass} px-2 whitespace-pre">${escapeHtml(part.value)}</div>`;
                if (part.added) rewrittenDiv.innerHTML += line;
                else if (part.removed) originalDiv.innerHTML += line;
                else { originalDiv.innerHTML += line; rewrittenDiv.innerHTML += line; }
            });
            hljs.highlightAll();
        }

        async function rewriteCode() {
            const code = document.getElementById('codeInput').value;
            const fixed = code.replace("'", "@username").replace("+=", "builder.Append");
            renderDiff(code, fixed);
            switchTab('rewrite');
        }

        function mockGithubPR() {
            const popup = document.getElementById('prPopup');
            popup.style.transform = "translateY(0)";
            setTimeout(() => { popup.style.transform = "translateY(240px)"; }, 4000);
        }

        function escapeHtml(text) {
            const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'};
            return text.replace(/[&<>"']/g, m => map[m]);
        }
    </script>
</body>
</html>